      - name: Wait for services (robust)
        run: |
          set -e
          echo "Waiting for gateway..."
          deadline=$((SECONDS+240))
          until curl -fsS http://localhost:18088/health; do
            if [ $SECONDS -ge $deadline ]; then
              echo "::error::gateway health timeout"
              docker compose ps || true
              docker compose logs --no-color gateway || true
              exit 1
            fi
            sleep 3
          done
          echo "Waiting for planner..."
          deadline=$((SECONDS+240))
          until curl -fsS http://localhost:19090/health; do
            if [ $SECONDS -ge $deadline ]; then
              echo "::error::planner health timeout"
              docker compose ps || true
              docker compose logs --no-color planner || true
              exit 1
            fi
            sleep 3
          done

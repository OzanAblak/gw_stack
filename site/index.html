<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <title>GW Stack – Geliştirici Odaklı Gateway & Tooling</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <!--
    GW Stack Landing
    FAZ-47 / GATE-2: billingApiClient HTTP helper eklendi.
    FAZ-47 / GATE-3: Starter plan için stub checkout butonu bağlandı.
    FAZ-47 / GATE-4+5: checkout + status çağrıları ile success / fail_card senaryoları oynatılıyor.
    FAZ-47 / GATE-6+7: Checkout sonucu paneli + abonelik durumu paneli eklendi.
    FAZ-47 / GATE-8: Landing metinleri gateway + payment hikâyesine göre rafine edildi.
  -->
  <style>
    :root {
      --bg: #050816;
      --bg-alt: #0b1020;
      --card-bg: #0f172a;
      --border-subtle: #1f2937;
      --accent: #38bdf8;
      --accent-soft: rgba(56, 189, 248, 0.12);
      --accent-strong: #22c55e;
      --text: #e5e7eb;
      --text-soft: #9ca3af;
      --danger: #f97373;
      --radius-xl: 18px;
      --radius-lg: 12px;
      --shadow-soft: 0 18px 45px rgba(15, 23, 42, 0.75);
      --shadow-pill: 0 10px 30px rgba(15, 23, 42, 0.7);
      --pill-bg: rgba(15, 23, 42, 0.9);
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: radial-gradient(circle at top, #0f172a 0, #020617 55%, #020617 100%);
      color: var(--text);
      min-height: 100vh;
    }

    .page {
      max-width: 1160px;
      margin: 0 auto;
      padding: 32px 16px 72px;
    }

    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 32px;
    }

    .logo {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .logo-mark {
      width: 32px;
      height: 32px;
      border-radius: 999px;
      background: radial-gradient(circle at 30% 30%, #38bdf8, #1d4ed8);
      box-shadow: 0 0 0 1px rgba(148, 163, 184, 0.25),
        0 12px 25px rgba(37, 99, 235, 0.6);
      position: relative;
      overflow: hidden;
    }

    .logo-mark::after {
      content: "";
      position: absolute;
      inset: 20%;
      border-radius: 999px;
      border: 2px solid rgba(15, 23, 42, 0.6);
      box-shadow: 0 0 0 1px rgba(15, 23, 42, 0.8);
    }

    .logo-text-main {
      font-weight: 600;
      letter-spacing: 0.06em;
      font-size: 0.95rem;
      text-transform: uppercase;
    }

    .logo-text-sub {
      font-size: 0.75rem;
      color: var(--text-soft);
    }

    .header-pill {
      padding: 8px 14px;
      border-radius: 999px;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      background: linear-gradient(
        110deg,
        rgba(56, 189, 248, 0.12),
        rgba(34, 197, 94, 0.2)
      );
      border: 1px solid rgba(148, 163, 184, 0.32);
      box-shadow: var(--shadow-pill);
      font-size: 0.75rem;
    }

    .header-pill-dot {
      width: 8px;
      height: 8px;
      border-radius: 999px;
      background: var(--accent-strong);
      box-shadow: 0 0 0 6px rgba(34, 197, 94, 0.25);
    }

    main {
      display: grid;
      grid-template-columns: minmax(0, 3fr) minmax(0, 2.5fr);
      gap: 24px;
    }

    @media (max-width: 920px) {
      main {
        grid-template-columns: minmax(0, 1fr);
      }
    }

    .hero {
      background: radial-gradient(circle at top left, #0b1120, var(--bg-alt));
      border-radius: 26px;
      padding: 26px 24px 24px;
      border: 1px solid rgba(148, 163, 184, 0.32);
      box-shadow: var(--shadow-soft);
      position: relative;
      overflow: hidden;
    }

    .hero-tagline {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 5px 11px;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.85);
      border: 1px solid rgba(148, 163, 184, 0.32);
      font-size: 0.72rem;
      margin-bottom: 14px;
      color: var(--text-soft);
    }

    .hero-tagline-pill {
      padding: 2px 8px;
      border-radius: 999px;
      background: rgba(56, 189, 248, 0.15);
      color: #e0f2fe;
      font-weight: 500;
      font-size: 0.7rem;
    }

    .hero-title {
      font-size: 2.3rem;
      line-height: 1.15;
      letter-spacing: -0.04em;
      margin-bottom: 10px;
    }

    .hero-title span.highlight {
      background: linear-gradient(120deg, #38bdf8, #22c55e);
      -webkit-background-clip: text;
      color: transparent;
    }

    .hero-subtitle {
      font-size: 0.95rem;
      color: var(--text-soft);
      max-width: 500px;
      margin-bottom: 18px;
    }

    .hero-subtitle strong {
      color: #e5e7eb;
      font-weight: 500;
    }

    .hero-metrics {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      margin-bottom: 16px;
    }

    .metric-pill {
      padding: 7px 11px;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.9);
      border: 1px solid rgba(31, 41, 55, 0.9);
      font-size: 0.75rem;
      display: inline-flex;
      align-items: baseline;
      gap: 5px;
      color: var(--text-soft);
    }

    .metric-pill strong {
      color: #e5e7eb;
      font-size: 0.8rem;
    }

    .hero-actions {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-bottom: 12px;
    }

    .btn-primary,
    .btn-secondary,
    .btn-ghost {
      border-radius: 999px;
      padding: 9px 16px;
      font-size: 0.85rem;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 7px;
    }

    .btn-primary {
      border: none;
      font-size: 0.9rem;
      font-weight: 500;
      background: linear-gradient(120deg, #38bdf8, #22c55e);
      color: #020617;
      box-shadow: 0 20px 40px rgba(34, 197, 94, 0.35);
    }

    .btn-secondary {
      border: 1px solid rgba(148, 163, 184, 0.45);
      background: rgba(15, 23, 42, 0.89);
      color: var(--text-soft);
    }

    .btn-secondary span.dot {
      width: 7px;
      height: 7px;
      border-radius: 999px;
      background: var(--accent);
    }

    .btn-ghost {
      border: 1px solid rgba(148, 163, 184, 0.25);
      background: rgba(15, 23, 42, 0.9);
      color: var(--text-soft);
    }

    .btn-ghost span.dot {
      width: 7px;
      height: 7px;
      border-radius: 999px;
      background: var(--danger);
    }

    .hero-footnote {
      font-size: 0.7rem;
      color: var(--text-soft);
    }

    .hero-footnote span {
      color: #e5e7eb;
    }

    .hero-bg-orbit {
      position: absolute;
      top: -60px;
      right: -60px;
      width: 220px;
      height: 220px;
      border-radius: 999px;
      background: radial-gradient(circle at 30% 30%, rgba(56, 189, 248, 0.55), transparent 65%);
      opacity: 0.6;
      filter: blur(1px);
    }

    .hero-bg-orbit-inner {
      position: absolute;
      inset: 30px;
      border-radius: 999px;
      border: 1px dashed rgba(148, 163, 184, 0.35);
      backdrop-filter: blur(14px);
      background: radial-gradient(circle, rgba(15, 23, 42, 0.9), rgba(15, 23, 42, 0.4));
    }

    .hero-bg-orbit-inner span {
      position: absolute;
      width: 7px;
      height: 7px;
      border-radius: 999px;
      background: #22c55e;
      box-shadow: 0 0 0 5px rgba(34, 197, 94, 0.3);
      top: 15%;
      right: 18%;
    }

    /* Checkout status panel */

    .checkout-status-panel {
      margin-top: 14px;
      padding: 10px 12px;
      border-radius: var(--radius-lg);
      background: rgba(15, 23, 42, 0.92);
      border: 1px solid rgba(148, 163, 184, 0.4);
      font-size: 0.78rem;
    }

    .checkout-status-title {
      font-weight: 500;
      font-size: 0.78rem;
      margin-bottom: 4px;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .checkout-status-dot {
      width: 7px;
      height: 7px;
      border-radius: 999px;
      background: rgba(148, 163, 184, 0.9);
    }

    .checkout-status-body {
      white-space: pre-line;
      color: var(--text-soft);
    }

    .checkout-status-panel[data-state="success"] {
      border-color: rgba(34, 197, 94, 0.7);
      box-shadow: 0 0 0 1px rgba(34, 197, 94, 0.2);
    }

    .checkout-status-panel[data-state="success"] .checkout-status-dot {
      background: var(--accent-strong);
    }

    .checkout-status-panel[data-state="error"] {
      border-color: rgba(248, 113, 113, 0.7);
      box-shadow: 0 0 0 1px rgba(248, 113, 113, 0.2);
    }

    .checkout-status-panel[data-state="error"] .checkout-status-dot {
      background: var(--danger);
    }

    /* Right column */

    .side-panel {
      display: flex;
      flex-direction: column;
      gap: 14px;
    }

    .card {
      background: linear-gradient(145deg, rgba(15, 23, 42, 0.98), rgba(15, 23, 42, 0.92));
      border-radius: var(--radius-xl);
      padding: 16px 14px;
      border: 1px solid var(--border-subtle);
      box-shadow: 0 18px 36px rgba(15, 23, 42, 0.9);
    }

    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
    }

    .card-title {
      font-size: 0.9rem;
      font-weight: 500;
    }

    .card-tag {
      font-size: 0.7rem;
      padding: 4px 9px;
      border-radius: 999px;
      background: rgba(56, 189, 248, 0.16);
      border: 1px solid rgba(56, 189, 248, 0.5);
      color: #e0f2fe;
    }

    .feature-list {
      list-style: none;
      display: grid;
      gap: 7px;
      font-size: 0.8rem;
      color: var(--text-soft);
    }

    .feature-list li {
      display: flex;
      gap: 8px;
      align-items: flex-start;
    }

    .feature-bullet {
      width: 7px;
      height: 7px;
      border-radius: 999px;
      margin-top: 4px;
      background: var(--accent);
      flex-shrink: 0;
    }

    .plan-card {
      display: grid;
      grid-template-columns: 2fr 2fr;
      gap: 12px;
      font-size: 0.8rem;
    }

    @media (max-width: 920px) {
      .plan-card {
        grid-template-columns: 1fr;
      }
    }

    .plan-block {
      border-radius: var(--radius-lg);
      background: radial-gradient(circle at top left, rgba(56, 189, 248, 0.18), rgba(15, 23, 42, 0.99));
      border: 1px solid rgba(148, 163, 184, 0.4);
      padding: 11px 12px;
    }

    .plan-label {
      font-size: 0.72rem;
      color: var(--text-soft);
      text-transform: uppercase;
      letter-spacing: 0.06em;
      margin-bottom: 4px;
    }

    .plan-name {
      font-size: 0.95rem;
      font-weight: 500;
      margin-bottom: 4px;
    }

    .plan-price {
      font-size: 0.85rem;
      color: var(--text-soft);
      margin-bottom: 8px;
    }

    .pill-row {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
    }

    .pill {
      font-size: 0.7rem;
      padding: 4px 8px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.4);
      background: rgba(15, 23, 42, 0.9);
      color: var(--text-soft);
    }

    .timeline {
      font-size: 0.78rem;
      color: var(--text-soft);
      display: grid;
      gap: 6px;
    }

    .timeline-row {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .timeline-dot {
      width: 8px;
      height: 8px;
      border-radius: 999px;
      background: var(--accent);
    }

    .timeline-dot.muted {
      background: rgba(148, 163, 184, 0.7);
    }

    .timeline-label {
      min-width: 82px;
      font-size: 0.7rem;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: rgba(148, 163, 184, 0.85);
    }

    .timeline-text {
      flex: 1;
    }

    .subscription-status {
      font-size: 0.78rem;
      color: var(--text-soft);
      padding: 6px 0 8px;
    }

    .subscription-actions {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
    }

    .subscription-actions .btn-ghost {
      font-size: 0.75rem;
      padding: 6px 10px;
    }

    footer {
      margin-top: 24px;
      font-size: 0.7rem;
      color: var(--text-soft);
      display: flex;
      justify-content: space-between;
      gap: 12px;
      flex-wrap: wrap;
    }

    .footer-badge {
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    .footer-badge span.dot {
      width: 6px;
      height: 6px;
      border-radius: 999px;
      background: var(--accent-strong);
    }
  </style>
</head>
<body>
  <div class="page">
    <header>
      <div class="logo">
        <div class="logo-mark"></div>
        <div>
          <div class="logo-text-main">GW STACK</div>
          <div class="logo-text-sub">Gateway · Planner · Tooling</div>
        </div>
      </div>
      <div class="header-pill">
        <span class="header-pill-dot"></span>
        <span>Early access açılıyor · Gateway + payment-ready omurga hazır</span>
      </div>
    </header>

    <main>
      <!-- SOL: HERO -->
      <section class="hero">
        <div class="hero-bg-orbit">
          <div class="hero-bg-orbit-inner">
            <span></span>
          </div>
        </div>

        <div class="hero-tagline">
          <span class="hero-tagline-pill">Prod seviyesinde gateway &amp; release</span>
          <span>CI, smoke, release ve billing aynı omurgada</span>
        </div>

        <h1 class="hero-title">
          Gateway, log ve
          <span class="highlight">ödeme trafiğini</span>
          tek yerden yönet.
        </h1>

        <p class="hero-subtitle">
          GW Stack, küçük ekipler için tasarlanmış bir <strong>gateway + gözlenebilirlik + billing</strong> iskeleti.
          İlk müşteriden önce bile <strong>deploy ettik mi, para akıyor mu?</strong> sorusunu;
          CI, smoke, release ve ödeme stub'larını aynı akışa bağlayarak cevaplıyor.
        </p>

        <div class="hero-metrics">
          <div class="metric-pill">
            <strong>Production-grade CI</strong>
            <span>smoke · post-smoke · release draft tek zincirde</span>
          </div>
          <div class="metric-pill">
            <strong>Payment-ready omurga</strong>
            <span>billing_api stub + error codes + entegrasyon planı</span>
          </div>
        </div>

        <div class="hero-actions">
          <button
            class="btn-primary"
            type="button"
            onclick="window.__gwStartCheckoutStub && window.__gwStartCheckoutStub('starter');"
          >
            Starter (başarılı) stub checkout
            <span>→</span>
          </button>
          <button
            class="btn-ghost"
            type="button"
            onclick="window.__gwStartCheckoutStub && window.__gwStartCheckoutStub('fail_card');"
          >
            <span class="dot"></span>
            Kart reddi senaryosu (stub)
          </button>
          <button
            class="btn-secondary"
            type="button"
            onclick="document.getElementById('how-it-works')?.scrollIntoView({ behavior: 'smooth' });"
          >
            <span class="dot"></span>
            Nasıl çalışıyor?
          </button>
        </div>

        <div class="hero-footnote">
          <span>Şu anda payment hattı, gerçek entegrasyon öncesi <strong>tasarım + stub</strong> seviyesinde.</span>
          Gerçek provider'a geçmeden önce bile ekiplerine uçtan uca <strong>checkout + status + subscription</strong> senaryolarını oynatıyor.
        </div>

        <div class="checkout-status-panel" id="checkout-status-panel">
          <div class="checkout-status-title">
            <span class="checkout-status-dot"></span>
            <span>Checkout durumu (stub)</span>
          </div>
          <div class="checkout-status-body" id="checkout-status-body">
            Henüz checkout başlatılmadı.
          </div>
        </div>
      </section>

      <!-- SAĞ: PLANLAR + AKIŞ -->
      <aside class="side-panel">
        <section class="card">
          <div class="card-header">
            <div class="card-title">Starter plan · İlk ekipler için</div>
            <span class="card-tag">Early access</span>
          </div>
          <div class="plan-card">
            <div class="plan-block">
              <div class="plan-label">Plan</div>
              <div class="plan-name">Starter</div>
              <div class="plan-price">Gateway + planner + temel smoke seti</div>
              <div class="pill-row">
                <span class="pill">Tek ortamdan tüm trafik görünümü</span>
                <span class="pill">Release &amp; smoke entegrasyonu</span>
                <span class="pill">Payment-ready domain &amp; contract</span>
              </div>
            </div>
            <div class="plan-block">
              <div class="plan-label">Yakında</div>
              <div class="plan-name">Teams &amp; Scale</div>
              <div class="plan-price">Çoklu environment, role-based görünürlük</div>
              <div class="pill-row">
                <span class="pill">Team dashboard</span>
                <span class="pill">Gelişmiş alerting</span>
              </div>
            </div>
          </div>
        </section>

        <section class="card">
          <div class="card-header">
            <div class="card-title">Akış: kod → deploy → ödeme</div>
            <span class="card-tag">GW Stack zihniyeti</span>
          </div>
          <div class="timeline" id="how-it-works">
            <div class="timeline-row">
              <div class="timeline-dot"></div>
              <div class="timeline-label">Code</div>
              <div class="timeline-text">
                Branch push → smoke → release pipeline. Her adım kendi output'unu bırakır.
              </div>
            </div>
            <div class="timeline-row">
              <div class="timeline-dot"></div>
              <div class="timeline-label">Gateway</div>
              <div class="timeline-text">
                Gateway, health ve trafik durumunu release'e geri bildirir; “ship ettik” demeden önce hatayı yakalar.
              </div>
            </div>
            <div class="timeline-row">
              <div class="timeline-dot muted"></div>
              <div class="timeline-label">Billing</div>
              <div class="timeline-text">
                FAZ-46 ile payment domain + billing_api stub tamamlandı.
                FAZ-47 ile landing, <strong>checkout + status + subscription</strong> çağrılarını bu stub'a bağlayarak
                gerçek ödeme öncesi akışı kanıtlıyor.
              </div>
            </div>
          </div>
        </section>

        <section class="card">
          <div class="card-header">
            <div class="card-title">Payment tarafında bugün neredeyiz?</div>
            <span class="card-tag">Design + stub</span>
          </div>
          <ul class="feature-list">
            <li>
              <span class="feature-bullet"></span>
              <span>Payment domain modeli, API contract ve happy-path test planı <strong>dokümante</strong>.</span>
            </li>
            <li>
              <span class="feature-bullet"></span>
              <span><code>/api/billing/checkout/start</code>, <code>/status</code> ve <code>/subscription</code> için <strong>working stub</strong> hazır.</span>
            </li>
            <li>
              <span class="feature-bullet"></span>
              <span><code>PLAN_CODE_REQUIRED</code>, <code>CARD_DECLINED</code>, <code>SUBSCRIPTION_NOT_FOUND</code> vb. error code'lar <strong>standardize</strong>.</span>
            </li>
            <li>
              <span class="feature-bullet"></span>
              <span>Sonraki fazlarda gerçek provider adapter'i ve CI/site_check → billing health entegrasyonu devreye alınacak.</span>
            </li>
          </ul>
        </section>

        <section class="card">
          <div class="card-header">
            <div class="card-title">Abonelik durumu (stub · dev görünümü)</div>
            <span class="card-tag">SUBSCRIPTION API</span>
          </div>
          <div class="subscription-status" id="subscription-status-body">
            Henüz sorgu yapılmadı.
          </div>
          <div class="subscription-actions">
            <button
              class="btn-ghost"
              type="button"
              onclick="window.__gwCheckSubscriptionStub && window.__gwCheckSubscriptionStub(false);"
            >
              Aktif abonelik örneği
            </button>
            <button
              class="btn-ghost"
              type="button"
              onclick="window.__gwCheckSubscriptionStub && window.__gwCheckSubscriptionStub(true);"
            >
              Abonelik yok senaryosu
            </button>
          </div>
        </section>
      </aside>
    </main>

    <footer>
      <div class="footer-badge">
        <span class="dot"></span>
        <span>FAZ-46: Payment domain &amp; billing_api stub · FAZ-47: Landing entegrasyonu ve görünürlük</span>
      </div>
      <div>
        <span>GW Stack • Build once, observe always.</span>
      </div>
    </footer>
  </div>

  <!--
    FAZ-47 / GATE-2
    Billing API HTTP helper: Landing tarafı, payment stub ile konuşmak için
    window.billingApiClient üzerinden startCheckout / getCheckoutStatus / getSubscription kullanıyor.

    FAZ-47 / GATE-3
    Starter plan butonu, stub checkout başlatıyor (planCode='starter').

    FAZ-47 / GATE-4+5
    Checkout sonrası paymentAttemptId ile /status çağrısı yapılıp
    success / fail_card senaryoları kullanıcıya özetleniyor.

    FAZ-47 / GATE-6+7
    Checkout sonucu paneli + abonelik durumu paneli üzerinden gösteriliyor.

    FAZ-47 / GATE-8
    Metinler, gateway + payment hikâyesini product diline daha yakın anlatacak şekilde rafine edildi.
  -->
  <script>
    (function () {
      // İlk aşamada sabit; ileride build/ENV üzerinden beslenecek.
      const BILLING_API_BASE_URL = 'http://127.0.0.1:19100';

      async function startCheckout(planCode) {
        const response = await fetch(BILLING_API_BASE_URL + '/api/billing/checkout/start', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({
            planCode: planCode,
            // Stub aşamasında bile gerçek hayata benzer dursun diye success/cancel URL'leri gönderiyoruz
            successUrl: window.location.origin + '/checkout-success',
            cancelUrl: window.location.origin + '/checkout-cancel'
          })
        });

        let data;
        try {
          data = await response.json();
        } catch (e) {
          data = null;
        }

        return {
          ok: response.ok,
          status: response.status,
          data: data
        };
      }

      async function getCheckoutStatus(paymentAttemptId) {
        const url =
          BILLING_API_BASE_URL +
          '/api/billing/checkout/status?paymentAttemptId=' +
          encodeURIComponent(paymentAttemptId);

        const response = await fetch(url);

        let data;
        try {
          data = await response.json();
        } catch (e) {
          data = null;
        }

        return {
          ok: response.ok,
          status: response.status,
          data: data
        };
      }

      async function getSubscription(testNoSubscription) {
        let url = BILLING_API_BASE_URL + '/api/billing/subscription';
        if (testNoSubscription) {
          url += '?testNoSubscription=true';
        }

        const response = await fetch(url);

        let data;
        try {
          data = await response.json();
        } catch (e) {
          data = null;
        }

        return {
          ok: response.ok,
          status: response.status,
          data: data
        };
      }

      function updateCheckoutStatusPanel(state, text) {
        const panel = document.getElementById('checkout-status-panel');
        const body = document.getElementById('checkout-status-body');
        if (!panel || !body) {
          return;
        }

        panel.removeAttribute('data-state');
        if (state) {
          panel.setAttribute('data-state', state);
        }

        body.textContent = text;
      }

      // Global export (Landing UI buradan kullanacak)
      window.billingApiClient = {
        startCheckout: startCheckout,
        getCheckoutStatus: getCheckoutStatus,
        getSubscription: getSubscription
      };

      // Stub demo: checkout + status ile success / fail_card akışını özetler
      async function demoStartCheckout(planCode) {
        if (!planCode) {
          alert('Plan seçilmedi (stub: planCode boş).');
          return;
        }

        updateCheckoutStatusPanel(
          null,
          'Checkout başlatılıyor...\nPlan: ' + planCode
        );

        try {
          // 1) Checkout başlat
          const result = await window.billingApiClient.startCheckout(planCode);

          if (!result.ok) {
            const detail = result.data && result.data.detail;
            const code = detail && detail.code;
            const msg = detail && detail.message;

            const summary =
              'Checkout hata (HTTP ' +
              result.status +
              '): ' +
              (code ? code + ' - ' : '') +
              (msg || 'bilinmeyen hata (stub)');

            updateCheckoutStatusPanel('error', summary);
            alert(summary);
            return;
          }

          const attemptId =
            result.data && result.data.paymentAttemptId;
          const subId =
            result.data && result.data.subscriptionId;

          if (!attemptId) {
            const summary =
              'Checkout stub yanıtında paymentAttemptId yok (beklenmeyen durum).';

            updateCheckoutStatusPanel('error', summary);
            alert(summary);
            return;
          }

          // 2) Status sor
          const statusResult =
            await window.billingApiClient.getCheckoutStatus(attemptId);

          if (!statusResult.ok) {
            const detail2 = statusResult.data && statusResult.data.detail;
            const code2 = detail2 && detail2.code;
            const msg2 = detail2 && detail2.message;

            const summary2 =
              'Status hata (HTTP ' +
              statusResult.status +
              '): ' +
              (code2 ? code2 + ' - ' : '') +
              (msg2 || 'bilinmeyen hata (stub)');

            updateCheckoutStatusPanel('error', summary2);
            alert(summary2);
            return;
          }

          const pa =
            statusResult.data && statusResult.data.paymentAttempt;
          const sub =
            statusResult.data && statusResult.data.subscription;

          let summaryLines = [];

          if (pa && pa.status === 'succeeded') {
            summaryLines.push('Ödeme durumu: BAŞARILI');
            summaryLines.push(
              'Abonelik durumu: ' +
              ((sub && sub.status) || '(bilinmiyor)')
            );
          } else if (pa && pa.status === 'failed') {
            const errCode = pa.errorCode || 'CARD_DECLINED';
            const userMsg =
              pa.userFacingMessage ||
              'Ödemeniz kart sağlayıcınız tarafından reddedildi. Lütfen farklı bir kart deneyin.';

            summaryLines.push(
              'Ödeme durumu: BAŞARISIZ (' + errCode + ')'
            );
            summaryLines.push(
              'Kullanıcı mesajı: ' + userMsg
            );
            summaryLines.push(
              'Abonelik durumu: ' +
              ((sub && sub.status) || '(bilinmiyor)')
            );
          } else {
            summaryLines.push(
              'Ödeme durumu: ' + ((pa && pa.status) || '(bilinmiyor)')
            );
            summaryLines.push(
              'Abonelik durumu: ' +
              ((sub && sub.status) || '(bilinmiyor)')
            );
          }

          const summary =
            'Plan: ' + planCode + '\n' +
            'PaymentAttemptId: ' + attemptId + '\n' +
            'SubscriptionId: ' + (subId || '(yok)') + '\n\n' +
            summaryLines.join('\n');

          const state =
            pa && pa.status === 'failed' ? 'error' : 'success';

          updateCheckoutStatusPanel(state, summary);
          alert('Checkout status (stub):\n\n' + summary);
        } catch (err) {
          const txt =
            'Checkout/status çağrıları sırasında beklenmeyen hata (stub).';

          updateCheckoutStatusPanel('error', txt);
          alert(txt);
        }
      }

      async function demoCheckSubscription(noSubscription) {
        const bodyEl = document.getElementById('subscription-status-body');
        if (bodyEl) {
          bodyEl.textContent = noSubscription
            ? 'Abonelik yok senaryosu (stub) sorgulanıyor...'
            : 'Aktif abonelik örneği (stub) sorgulanıyor...';
        }

        try {
          const result =
            await window.billingApiClient.getSubscription(noSubscription);

          if (!result.ok) {
            const detail = result.data && result.data.detail;
            const code = detail && detail.code;
            const msg = detail && detail.message;

            if (bodyEl) {
              bodyEl.textContent =
                'HTTP ' +
                result.status +
                ' · ' +
                (code ? code + ' - ' : '') +
                (msg || 'Abonelik bulunamadı (stub).');
            }
            return;
          }

          const sub = result.data && result.data.subscription;

          if (!sub) {
            if (bodyEl) {
              bodyEl.textContent =
                'Beklenmeyen yanıt: subscription nesnesi yok (stub).';
            }
            return;
          }

          if (bodyEl) {
            bodyEl.textContent =
              'Abonelik ID: ' +
              (sub.id || '(yok)') +
              ' · plan: ' +
              (sub.planCode || '(yok)') +
              ' · status: ' +
              (sub.status || '(bilinmiyor)');
          }
        } catch (e) {
          if (bodyEl) {
            bodyEl.textContent =
              'Abonelik çağrısı sırasında beklenmeyen hata (stub).';
          }
        }
      }

      // Hero butonları ve abonelik paneli için stub handler'lar
      window.__gwStartCheckoutStub = demoStartCheckout;
      window.__gwCheckSubscriptionStub = demoCheckSubscription;
    })();
  </script>
</body>
</html>
